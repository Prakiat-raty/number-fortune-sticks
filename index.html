<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>‡∏ò‡∏π‡∏õ‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</title>
  <meta name="theme-color" content="#0b0b0f" />
  <link rel="manifest" href="manifest.json" />
  <style>
    :root{
      --bg:#0b0b0f;
      --floor:#1a1a22;
      --stick:#8b5a3c;
      --ash:#d9d3c8;
      --ember:#ffcc66;
      --smoke:#ffffffcc;
      --burnYpx:0px;
      --revealH:0%;
    }
    html,body{height:100%;margin:0;background:radial-gradient(1200px 800px at 50% 10%, #16161d 0%, var(--bg) 70%);}
    body{color:#eaeaf0; font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans Thai",sans-serif;
      display:flex; align-items:center; justify-content:center; padding:16px;}

    .wrap{width:min(380px,92vw); display:flex; flex-direction:column; align-items:center; gap:12px;}
    h1{font-size:1.1rem; font-weight:700; margin:0; opacity:.9}

    .scene{
      position:relative; width:100%; aspect-ratio:3/5;
      border-radius:18px; background:linear-gradient(to bottom,#121219 0%,#0e0e14 50%,#0b0b0f 100%);
      box-shadow:0 10px 40px rgba(0,0,0,.6) inset, 0 20px 50px rgba(0,0,0,.5);
      overflow:hidden;
    }
    .floor{position:absolute; left:0; right:0; bottom:0; height:24%;
      background:radial-gradient(60% 100% at 50% 0%, #23232c 0%, var(--floor) 45%, #101018 100%);
      filter:blur(0.3px);}

    /* --- ‡∏ò‡∏π‡∏õ: ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô + ‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á 32% --- */
    .incense{
      position:absolute; left:50%; transform:translateX(-50%);
      bottom:22%; width:28px; height:32%;
      display:flex; align-items:flex-start; justify-content:center;
    }
    .stick{
      position:relative; width:100%; height:100%;
      background:linear-gradient(180deg,#9a6a46 0%, var(--stick) 65%, #6f452d 100%);
      border-radius:3px;
      box-shadow:inset 0 0 0 1px #6e4732, inset 0 -6px 14px rgba(0,0,0,.35);
      overflow:hidden;
    }

    .burned{position:absolute; left:0; top:0; width:100%; height:var(--burnYpx);
      background:repeating-linear-gradient(180deg,#cfc8bd 0 6px,#bdb6ab 6px 12px);
      box-shadow:inset 0 -6px 10px rgba(0,0,0,.35); transition:height .05s linear;}
    .coalLine{position:absolute; left:-2px; width:calc(100% + 4px); height:6px;
      top:calc(var(--burnYpx) - 3px);
      background:radial-gradient(16px 6px at 50% 50%, var(--ember) 0%, #ff914d 60%, rgba(255,0,0,.25) 100%);
      filter:blur(0.5px) brightness(1.05); mix-blend-mode:screen; pointer-events:none;}

    /* --- ‡πÄ‡∏õ‡∏•‡∏ß‡πÑ‡∏ü: ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á --- */
    .flame{position:absolute; left:50%; transform:translate(-50%,0);
      width:20px; height:30px; top:calc(var(--burnYpx) - 28px); pointer-events:none;}
    .flame::before,.flame::after{
      content:""; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
      width:100%; height:100%; border-radius:50% 50% 80% 80%/60% 60% 40% 40%;
      background:radial-gradient(ellipse at 50% 65%, #fff7c2 0%, #ffd36e 30%, #ff9a3d 60%, transparent 70%);
      animation:flicker .12s infinite alternate ease-in-out; filter:blur(0.4px);}
    .flame::after{width:78%; height:78%; opacity:.8; filter:blur(0.8px) brightness(1.1); animation-duration:.13s;}
    @keyframes flicker{from{transform:translate(-50%,-50%) scale(.95) rotate(-2deg)}to{transform:translate(-50%,-50%) scale(1.05) rotate(2deg)}}

    /* --- ‡∏Ñ‡∏ß‡∏±‡∏ô --- */
    .smoke{position:absolute; left:50%; width:8px; height:8px; top:calc(var(--burnYpx) - 10px); transform:translateX(-50%); pointer-events:none;}
    .puff{position:absolute; left:50%; top:50%; width:10px; height:10px; border-radius:50%;
      background:radial-gradient(circle at 50% 50%, var(--smoke) 0%, transparent 60%);
      animation:rise 3.8s linear infinite; opacity:0; filter:blur(1.2px);}
    .puff:nth-child(2){animation-delay:.9s} .puff:nth-child(3){animation-delay:1.8s} .puff:nth-child(4){animation-delay:2.7s}
    @keyframes rise{0%{transform:translate(-50%,-10px) scale(.6); opacity:0}10%{opacity:.35}100%{transform:translate(calc(-50% - 30px), -150px) scale(1.8); opacity:0}}

    /* --- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç: padding 12% ‡πÉ‡∏´‡πâ‡∏ä‡∏¥‡∏î‡∏Å‡∏±‡∏ô --- */
    .digits{
      position:absolute; inset:8px 0 8px 0; z-index:2;
      display:flex; flex-direction:column; align-items:center; justify-content:space-between;
      padding:12% 0;
      clip-path: inset(0 0 calc(100% - var(--revealH)) 0);
      transition:clip-path .05s linear; pointer-events:none;
    }
    .digit{
      font-weight:800; letter-spacing:.02em;
      text-shadow:0 1px 0 #5d3d2a, 0 2px 4px rgba(0,0,0,.4);
      background:linear-gradient(180deg,#ffe9b9 0%, #f7d88c 40%, #d4a85f 100%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      filter:drop-shadow(0 0 .5px #2b1b12);
      font-size:clamp(28px, 7vw, 36px);
      line-height:1;
    }

    .controls{display:flex; gap:10px; flex-wrap:wrap; justify-content:center}
    button{cursor:pointer; background:#2a2a35; color:#fff; border:1px solid #3a3a46;
      padding:10px 14px; border-radius:12px; font-weight:700; font-size:.98rem;
      box-shadow:0 6px 18px rgba(0,0,0,.35);}
    button:disabled{opacity:.55; cursor:not-allowed}
    .hint{font-size:.9rem; opacity:.75; text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>‡∏à‡∏∏‡∏î‡∏ò‡∏π‡∏õ‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</h1>
    <div class="scene">
      <div class="incense">
        <div class="stick">
          <div class="burned" id="burned"></div>
          <div class="coalLine" id="coal"></div>
          <div class="flame" id="flame" hidden></div>
          <div class="smoke" id="smoke" hidden>
            <div class="puff"></div><div class="puff"></div><div class="puff"></div><div class="puff"></div>
          </div>
          <div class="digits" id="digits">
            <div class="digit" id="d1">8</div>
            <div class="digit" id="d2">8</div>
            <div class="digit" id="d3">8</div>
          </div>
        </div>
      </div>
      <div class="floor"></div>
    </div>

    <div class="controls">
      <button id="igniteBtn">üî• ‡∏à‡∏∏‡∏î‡∏ò‡∏π‡∏õ</button>
      <button id="resetBtn" disabled>‚Ü∫ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
    </div>
    <div class="hint">URL ?num=538 ‡∏à‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏•‡∏Ç‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ (‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ = ‡∏™‡∏∏‡πà‡∏°)</div>
  </div>

  <script>
    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏Ç‡πÅ‡∏•‡∏∞‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô ‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° (‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤) ---
    function getTargetNumber(){
      const url=new URL(location.href);
      const s=(url.searchParams.get('num')||'').replace(/\D/g,'').slice(0,3);
      return s.length===3 ? s : String(Math.floor(100+Math.random()*900));
    }
    const d1=document.getElementById('d1'), d2=document.getElementById('d2'), d3=document.getElementById('d3');
    const burned=document.getElementById('burned'), coal=document.getElementById('coal');
    const flame=document.getElementById('flame'), smoke=document.getElementById('smoke');
    const digitsEl=document.getElementById('digits');
    const igniteBtn=document.getElementById('igniteBtn'), resetBtn=document.getElementById('resetBtn');
    let num=getTargetNumber(); [d1.textContent,d2.textContent,d3.textContent]=num.split('');
    let startTime=null, rafId=null, running=false;
    const BURN_DURATION=60_000;
    function layoutVars(progress){
      const H=document.querySelector('.stick').getBoundingClientRect().height;
      const burnYpx=Math.min(H-2, Math.max(0, H*progress));
      const revealH=Math.max(0,(burnYpx-8)/H*100);
      document.documentElement.style.setProperty('--burnYpx', burnYpx+'px');
      document.documentElement.style.setProperty('--revealH', revealH+'%');
    }
    function step(ts){
      if(!startTime) startTime=ts;
      const t=Math.min(1,(ts-startTime)/BURN_DURATION);
      layoutVars(t);
      flame.hidden = smoke.hidden = !(t>0 && t<1);
      burned.style.height=getComputedStyle(document.documentElement).getPropertyValue('--burnYpx');
      if(t<1){ rafId=requestAnimationFrame(step);}else{ running=false; igniteBtn.disabled=true; resetBtn.disabled=false;}
    }
    function ignite(){ if(running) return; running=true; igniteBtn.disabled=true; resetBtn.disabled=true; startTime=null; rafId=requestAnimationFrame(step);}
    function resetAll(){ cancelAnimationFrame(rafId); running=false; layoutVars(0); burned.style.height='0px'; flame.hidden=smoke.hidden=true; num=getTargetNumber(); [d1.textContent,d2.textContent,d3.textContent]=num.split(''); igniteBtn.disabled=false; resetBtn.disabled=true;}
    window.addEventListener('resize',()=>layoutVars(0)); layoutVars(0);
    igniteBtn.addEventListener('click',ignite); resetBtn.addEventListener('click',resetAll);
    if('serviceWorker' in navigator){ window.addEventListener('load',()=>navigator.serviceWorker.register('sw.js').catch(()=>{})); }
  </script>
</body>
</html>
