<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>‡∏ò‡∏π‡∏õ‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</title>
  <meta name="theme-color" content="#0b0b12" />
  <link rel="manifest" href="manifest.json" />
  <style>
    :root{
      --bg:#0b0b12;
      --bg2:#0a0a10;
      --floor:#181824;
      --stick:#8b5a3c;
      --ember:#ffcc66;
      --smoke:#ffffffcc;

      --burnYpx:0px;
      --revealH:0%;
      --flameHpx:26px;
      --flameWpx:18px;
      --coalTpx:6px;
    }

    html,body{height:100%;margin:0;background:radial-gradient(1200px 800px at 50% 10%, #191a25 0%, var(--bg) 70%);}
    body{
      color:#eef0f6; font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans Thai",sans-serif;
      display:flex; align-items:center; justify-content:center; padding:16px;
    }
    .wrap{width:min(420px,92vw); display:flex; flex-direction:column; align-items:center; gap:12px;}
    h1{font-size:1.1rem; font-weight:700; margin:0; opacity:.9}

    .scene{
      position:relative; width:100%; aspect-ratio:3/5;
      border-radius:18px;
      background:linear-gradient(to bottom,#11121a 0%,#10111a 40%,#0b0c13 100%);
      box-shadow: 0 10px 40px rgba(0,0,0,.6) inset, 0 20px 50px rgba(0,0,0,.5);
      overflow:hidden;
    }

    /* ‚Äî‚Äî‚Äî ‡∏Å‡∏£‡∏∞‡∏ñ‡∏≤‡∏á‡∏ò‡∏π‡∏õ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° ‚Äî‚Äî‚Äî */
    .censer{
      position:absolute; left:50%; transform:translateX(-50%);
      bottom:8%;
      width:60%; max-width:280px; aspect-ratio:7.5/3.8;
    }
    .censer .base{
      position:absolute; inset:0;
      background:
        radial-gradient(140% 130% at 50% -10%, #6d5f38 0%, #5a4d2d 35%, #3a3020 65%, transparent 66%),
        linear-gradient(180deg,#5e4f2a 0%, #2a2318 100%);
      border-radius:30px/18px;
      box-shadow:
        inset 0 3px 8px rgba(255,255,255,.18),
        inset 0 -8px 16px rgba(0,0,0,.5),
        0 12px 28px rgba(0,0,0,.55);
    }
    .censer .rim{
      position:absolute; left:5%; right:5%; top:-10%;
      height:22%;
      background:linear-gradient(180deg,#a68d48 0%, #7d683a 55%, #4e4022 100%);
      border-radius:22px/14px;
      box-shadow: inset 0 2px 6px rgba(255,255,255,.25), inset 0 -4px 8px rgba(0,0,0,.45);
    }
    .censer .shine{
      position:absolute; left:10%; right:10%; top:14%;
      height:24%;
      background:linear-gradient(90deg, transparent 0%, rgba(255,255,255,.14) 40%, rgba(255,255,255,.02) 60%, transparent 100%);
      border-radius:16px;
      mix-blend-mode:screen; opacity:.8;
    }
    .censer .legs{
      position:absolute; left:14%; right:14%; bottom:-16%;
      height:34%;
    }
    .leg{
      position:absolute; width:18%; height:100%; bottom:0;
      background:linear-gradient(180deg,#6b5b33 0%, #3d321f 100%);
      border-radius:8px;
      box-shadow: inset 0 2px 6px rgba(255,255,255,.18), inset 0 -4px 8px rgba(0,0,0,.5);
    }
    .leg.left{ left:0 }
    .leg.mid{ left:41% }
    .leg.right{ right:0 }

    /* ‡∏û‡∏∑‡πâ‡∏ô */
    .floor{
      position:absolute; left:0; right:0; bottom:0; height:26%;
      background:
        radial-gradient(80% 110% at 50% 0%, #23243a 0%, var(--floor) 46%, #0f1018 100%);
      filter: blur(.3px);
    }

    /* ‚Äî‚Äî‚Äî ‡∏ò‡∏π‡∏õ: ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô + ‡∏™‡∏±‡πâ‡∏ô 32% ‚Äî‚Äî‚Äî */
    .incense{
      position:absolute; left:50%; transform:translateX(-50%);
      bottom:calc(8% + 26% - 6%); /* ‡∏¢‡∏∑‡∏ô‡πÉ‡∏ô‡∏Å‡∏£‡∏∞‡∏ñ‡∏≤‡∏á‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢ */
      width:32px; height:32%;
      display:flex; align-items:flex-start; justify-content:center;
    }
    .stick{
      position:relative; width:100%; height:100%;
      background:linear-gradient(180deg,#ab7850 0%, var(--stick) 60%, #6f452d 100%);
      border-radius:3px;
      box-shadow:inset 0 0 0 1px #6e4732, inset 0 -6px 14px rgba(0,0,0,.35);
      overflow:hidden;
    }

    /* ‡∏™‡πà‡∏ß‡∏ô‡πÑ‡∏´‡∏°‡πâ/‡πÄ‡∏™‡πâ‡∏ô‡∏ñ‡πà‡∏≤‡∏ô */
    .burned{
      position:absolute; left:0; top:0; width:100%; height:var(--burnYpx);
      background:repeating-linear-gradient(180deg,#d9d3c8 0 6px,#c7c0b5 6px 12px);
      box-shadow:inset 0 -6px 10px rgba(0,0,0,.35);
      transition:height .05s linear;
    }
    .coalLine{
      position:absolute; left:-2px; width:calc(100% + 4px); height:var(--coalTpx);
      top:calc(var(--burnYpx) - (var(--coalTpx)/2));
      background:radial-gradient(16px var(--coalTpx) at 50% 50%, var(--ember) 0%, #ff914d 60%, rgba(255,0,0,.25) 100%);
      filter: blur(.5px) brightness(1.05);
      mix-blend-mode:screen; pointer-events:none;
    }

    /* ‡πÄ‡∏õ‡∏•‡∏ß‡πÑ‡∏ü/‡∏Ñ‡∏ß‡∏±‡∏ô ‡∏ú‡∏π‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÑ‡∏´‡∏°‡πâ */
    .flame{
      position:absolute; left:50%; transform:translate(-50%,0);
      width:var(--flameWpx); height:var(--flameHpx);
      top:calc(var(--burnYpx) - var(--flameHpx));
      pointer-events:none;
    }
    .flame::before,.flame::after{
      content:""; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
      width:100%; height:100%;
      border-radius:50% 50% 80% 80%/60% 60% 40% 40%;
      background:radial-gradient(ellipse at 50% 65%, #fff7c2 0%, #ffd36e 30%, #ff9a3d 60%, transparent 70%);
      animation:flicker .12s infinite alternate ease-in-out; filter:blur(.4px);
    }
    .flame::after{width:78%; height:78%; opacity:.85; filter:blur(.8px) brightness(1.1); animation-duration:.13s;}
    @keyframes flicker{from{transform:translate(-50%,-50%) scale(.94) rotate(-2deg)}to{transform:translate(-50%,-50%) scale(1.04) rotate(2deg)}}

    .smoke{
      position:absolute; left:50%; transform:translateX(-50%);
      width:8px; height:8px; top:calc(var(--burnYpx) - (var(--flameHpx)*0.35));
      pointer-events:none;
    }
    .puff{
      position:absolute; left:50%; top:50%; width:10px; height:10px; border-radius:50%;
      background:radial-gradient(circle at 50% 50%, var(--smoke) 0%, transparent 60%);
      animation:rise 3.4s linear infinite; opacity:0; filter:blur(1.2px);
    }
    .puff:nth-child(2){animation-delay:.8s}
    .puff:nth-child(3){animation-delay:1.6s}
    .puff:nth-child(4){animation-delay:2.4s}
    @keyframes rise{0%{transform:translate(-50%,-6px) scale(.6); opacity:0}10%{opacity:.35}100%{transform:translate(calc(-50% - 26px), -140px) scale(1.8); opacity:0}}

    /* ‚Äî‚Äî‚Äî ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç: ‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô (padding 12% ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô + 26% ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á) ‚Äî‚Äî‚Äî */
    .digits{
      position:absolute; inset:8px 0 8px 0; z-index:2;
      display:flex; flex-direction:column; align-items:center; justify-content:space-between;
      padding-top:12%; padding-bottom:26%;
      clip-path: inset(0 0 calc(100% - var(--revealH)) 0);
      transition:clip-path .05s linear; pointer-events:none;
    }
    .digit{
      font-weight:800; letter-spacing:.02em;
      text-shadow:0 1px 0 #5d3d2a, 0 2px 4px rgba(0,0,0,.4);
      background:linear-gradient(180deg,#ffe9b9 0%, #f7d88c 40%, #d4a85f 100%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      filter:drop-shadow(0 0 .5px #2b1b12);
      font-size:clamp(28px, 7vw, 36px);
      line-height:1;
    }

    .controls{display:flex; gap:10px; flex-wrap:wrap; justify-content:center}
    button{
      cursor:pointer; background:linear-gradient(180deg,#2e2e3a 0%, #232331 100%);
      color:#fff; border:1px solid #3a3a46;
      padding:10px 14px; border-radius:12px; font-weight:700; font-size:.98rem;
      box-shadow:0 6px 18px rgba(0,0,0,.35);
    }
    button:disabled{opacity:.55; cursor:not-allowed}
    .hint{font-size:.9rem; opacity:.75; text-align:center}

    /* ‚Äî‚Äî‚Äî Modal ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ò‡∏π‡∏õ ‚Äî‚Äî‚Äî */
    .modal{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,.5); backdrop-filter: blur(4px); z-index:50;
    }
    .modal.show{ display:flex; }
    .card{
      width:min(360px, 92vw);
      background:linear-gradient(180deg,#1b1b28 0%, #151522 100%);
      border:1px solid #2a2a3a; border-radius:16px; padding:18px;
      box-shadow:0 20px 60px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.04);
    }
    .card h2{margin:0 0 8px 0; font-size:1.05rem}
    .card p{margin:4px 0 14px 0; opacity:.85}
    .card .actions{display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap}
    .btn-primary{background:linear-gradient(180deg,#6d86ff 0%, #425aff 100%); border-color:#4b5cff}
    .btn-secondary{background:linear-gradient(180deg,#343445 0%, #2a2a3a 100%); border-color:#3a3a46}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>‡∏à‡∏∏‡∏î‡∏ò‡∏π‡∏õ‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</h1>

    <div class="scene">
      <!-- ‡∏Å‡∏£‡∏∞‡∏ñ‡∏≤‡∏á -->
      <div class="censer">
        <div class="rim"></div>
        <div class="base"></div>
        <div class="shine"></div>
        <div class="legs">
          <div class="leg left"></div>
          <div class="leg mid"></div>
          <div class="leg right"></div>
        </div>
      </div>

      <!-- ‡∏ò‡∏π‡∏õ -->
      <div class="incense">
        <div class="stick" id="stick">
          <div class="burned" id="burned"></div>
          <div class="coalLine" id="coal"></div>

          <div class="flame" id="flame" hidden></div>
          <div class="smoke" id="smoke" hidden>
            <div class="puff"></div><div class="puff"></div><div class="puff"></div><div class="puff"></div>
          </div>

          <div class="digits" id="digits">
            <div class="digit" id="d1">8</div>
            <div class="digit" id="d2">8</div>
            <div class="digit" id="d3">8</div>
          </div>
        </div>
      </div>

      <div class="floor"></div>
    </div>

    <div class="controls">
      <button id="igniteBtn">üî• ‡∏à‡∏∏‡∏î‡∏ò‡∏π‡∏õ</button>
      <button id="resetBtn" disabled>‚Ü∫ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
    </div>
  </div>

  <!-- Modal ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ò‡∏π‡∏õ -->
  <div class="modal" id="buyModal" aria-modal="true" role="dialog">
    <div class="card">
      <h2>‡∏ò‡∏π‡∏õ‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß</h2>
      <p>‡∏≠‡∏¢‡∏≤‡∏Å‡∏ï‡πà‡∏≠‡∏≠‡∏≤‡∏¢‡∏∏‡∏û‡∏¥‡∏ò‡∏µ‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡πÑ‡∏´‡∏°? ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ä‡∏∏‡∏î‡∏ò‡∏π‡∏õ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ó‡πâ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
      <div class="actions">
        <button class="btn-secondary" id="buyLaterBtn">‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô</button>
        <button class="btn-primary" id="buyNowBtn">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ò‡∏π‡∏õ</button>
      </div>
    </div>
  </div>

  <script>
    // ===== ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ =====
    function getTargetNumber(){
      const url=new URL(location.href);
      const s=(url.searchParams.get('num')||'').replace(/\D/g,'').slice(0,3);
      return s.length===3 ? s : String(Math.floor(100+Math.random()*900));
    }

    // ===== DOM =====
    const stick = document.getElementById('stick');
    const digitsEl = document.getElementById('digits');
    const burned = document.getElementById('burned');
    const coal = document.getElementById('coal');
    const flame = document.getElementById('flame');
    const smoke = document.getElementById('smoke');
    const igniteBtn = document.getElementById('igniteBtn');
    const resetBtn = document.getElementById('resetBtn');
    const d1 = document.getElementById('d1'), d2 = document.getElementById('d2'), d3 = document.getElementById('d3');

    const buyModal = document.getElementById('buyModal');
    const buyNowBtn = document.getElementById('buyNowBtn');
    const buyLaterBtn = document.getElementById('buyLaterBtn');

    // ===== ‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô =====
    let num = getTargetNumber();
    [d1.textContent, d2.textContent, d3.textContent] = num.split('');

    // ===== ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô =====
    let startTime = null, rafId = null, running = false;

    // ‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏´‡∏°‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (ms)
    const BURN_DURATION = 60_000;

    function setDynamicSizes(){
      const r = stick.getBoundingClientRect();
      const w = r.width;
      // ‡∏™‡πÄ‡∏Å‡∏•‡πÑ‡∏ü/‡πÄ‡∏™‡πâ‡∏ô‡∏ñ‡πà‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÅ‡∏ó‡πà‡∏á
      const flameH = Math.max(18, Math.min(30, w * 0.85));
      const flameW = Math.max(14, Math.min(26, w * 0.6));
      const coalT  = Math.max(4, Math.min(8,  Math.round(w * 0.22)));
      document.documentElement.style.setProperty('--flameHpx', flameH + 'px');
      document.documentElement.style.setProperty('--flameWpx', flameW + 'px');
      document.documentElement.style.setProperty('--coalTpx',  coalT + 'px');
    }

    function layoutVars(progress){
      const H = stick.getBoundingClientRect().height;
      const burnYpx = Math.min(H - 2, Math.max(0, H * progress));
      const revealH = Math.max(0, (burnYpx - 6) / H * 100);
      document.documentElement.style.setProperty('--burnYpx', burnYpx + 'px');
      document.documentElement.style.setProperty('--revealH', revealH + '%');
    }

    function step(ts){
      if (!startTime) startTime = ts;
      const t = Math.min(1, (ts - startTime) / BURN_DURATION);
      layoutVars(t);

      flame.hidden = smoke.hidden = !(t > 0 && t < 1);
      burned.style.height = getComputedStyle(document.documentElement).getPropertyValue('--burnYpx');

      if (t < 1){
        rafId = requestAnimationFrame(step);
      } else {
        running = false;
        igniteBtn.disabled = true;
        resetBtn.disabled = false;

        // üéØ ‡∏ò‡∏π‡∏õ‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß -> ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏°‡∏î‡∏±‡∏• "‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ò‡∏π‡∏õ"
        buyModal.classList.add('show');
      }
    }

    function ignite(){
      if (running) return;
      running = true;
      igniteBtn.disabled = true;
      resetBtn.disabled = true;
      startTime = null;
      rafId = requestAnimationFrame(step);
    }

    function resetAll(){
      cancelAnimationFrame(rafId);
      running = false;
      startTime = null;
      layoutVars(0);
      burned.style.height = '0px';
      flame.hidden = true;
      smoke.hidden = true;
      num = getTargetNumber();
      [d1.textContent, d2.textContent, d3.textContent] = num.split('');
      igniteBtn.disabled = false;
      resetBtn.disabled = true;
      buyModal.classList.remove('show');
    }

    function onResize(){
      setDynamicSizes();
      const cur = startTime ? Math.min(1, (performance.now() - startTime) / BURN_DURATION) : 0;
      layoutVars(cur);
    }

    window.addEventListener('resize', onResize);
    onResize();
    layoutVars(0);

    igniteBtn.addEventListener('click', ignite);
    resetBtn.addEventListener('click', resetAll);

    // ‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏°‡∏î‡∏±‡∏•
    buyLaterBtn.addEventListener('click', ()=> buyModal.classList.remove('show'));
    buyNowBtn.addEventListener('click', ()=>{
      // ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡πâ‡∏≤‡∏ô/‡πÄ‡∏û‡∏¢‡πå‡πÄ‡∏°‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ä‡πâ placeholder)
      // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Line OA / FB Shop / PromptPay Link / ‡πÄ‡∏ß‡πá‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
      window.open('https://your-shop.example.com/incense', '_blank');
    });

    // Service Worker
    if ('serviceWorker' in navigator){
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(()=>{});
      });
    }
  </script>
</body>
</html>
